<!DOCTYPE html>
<html lang="es" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Selector Lumix Beta (v30)</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter & Roboto Condensed -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Roboto+Condensed:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        lumix: {
                            red: '#E60012',
                            dark: '#121212',
                            gray: '#2A2A2A',
                            light: '#E5E5E5',
                            gold: '#FFD700'
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        tech: ['Roboto Condensed', 'sans-serif']
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #0f0f0f;
            color: #e5e5e5;
        }
        
        /* Scrollbar personalizado sutil */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #1a1a1a; }
        ::-webkit-scrollbar-thumb { background: #444; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #E60012; }

        .lumix-card {
            transition: all 0.3s ease;
            border: 1px solid #333;
        }
        .lumix-card:hover {
            transform: translateY(-5px);
            border-color: #E60012;
            box-shadow: 0 10px 30px -10px rgba(230, 0, 18, 0.3);
        }

        .lumix-checkbox:checked {
            background-color: #E60012;
            border-color: #E60012;
        }

        .featured-label {
            color: #FFD700; /* Mantenemos el dorado para destacar */
            text-shadow: 0 0 5px rgba(255, 215, 0, 0.2);
        }

        /* --- MOTOR DE IMPRESIÓN RESTAURADO Y FORZADO A LANDSCAPE --- */
        @media print {
            @page { 
                size: landscape; 
                margin: 0.5cm;
            }
            
            * {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                box-shadow: none !important;
                text-shadow: none !important;
                background-color: transparent !important;
                color: black !important;
                border-radius: 0 !important;
            }

            /* Ocultar elementos de UI */
            header, aside, #compare-tray, #toast, #search-input, .group, .flex.gap-2, #btn-grid, #btn-list, .print-hidden, button, .no-print { 
                display: none !important; 
            }

            body { 
                background: white !important; 
                font-family: Arial, Helvetica, sans-serif !important; 
                margin: 0 !important;
                padding: 0 !important;
                font-size: 9pt; /* Fuente ligeramente más pequeña para que quepa mejor */
                width: 100% !important;
            }

            main { display: none !important; }

            body.modal-open #comparison-modal, 
            body.modal-open #detail-modal {
                display: block !important;
                position: static !important;
                width: 100% !important;
                height: auto !important;
                overflow: visible !important;
                border: none !important;
            }

            table {
                width: 100% !important;
                border-collapse: collapse !important;
                margin-top: 10px;
                border: 1px solid #000 !important;
                page-break-inside: auto;
            }
            
            thead { display: table-header-group; }
            tr { page-break-inside: avoid; }
            
            th, td {
                border: 1px solid #000 !important; 
                padding: 4px 6px !important; /* Padding reducido para impresión */
                text-align: left;
                vertical-align: middle;
            }
            
            th { 
                background-color: #f0f0f0 !important; 
                font-weight: bold; 
                text-align: center !important;
                vertical-align: bottom !important;
            }

            td:first-child {
                background-color: #fafafa !important;
                font-weight: bold;
                width: 130px !important; 
                white-space: nowrap !important; 
            }

            th img {
                max-height: 35px !important;
                width: auto !important;
                margin: 0 auto 5px auto;
                display: block;
            }
            
            .price-tag {
                color: #000 !important;
                font-size: 10pt;
                font-weight: bold;
            }

            .print-header {
                display: flex !important;
                justify-content: space-between;
                align-items: flex-end;
                margin-bottom: 10px;
                border-bottom: 2px solid #000;
                padding-bottom: 5px;
            }
            .print-header h2 {
                margin: 0;
                font-size: 14pt;
                text-transform: uppercase;
                font-weight: bold;
            }
            .print-header p {
                margin: 0;
                font-size: 8pt;
                color: #555 !important;
            }
            .print-header img {
                height: 25px !important;
                filter: invert(1) !important; 
            }

            /* Ajustes Detail Modal Print */
            #detail-modal .flex-col { display: block !important; }
            #detail-modal .w-full, #detail-modal .md\:w-1\/3, #detail-modal .md\:w-2\/3 { 
                width: 100% !important; 
                display: block !important; 
                margin-bottom: 10px; 
            }
            #detail-modal h2 { font-size: 16pt !important; border-bottom: 1px solid black; margin-bottom: 10px; }
            #detail-modal .bg-gray-800 { 
                border: 1px solid #000 !important;
                margin-bottom: 10px;
                padding: 5px;
            }
            #detail-modal .grid {
                display: block !important;
            }
            #detail-modal .grid > div {
                display: inline-block !important;
                width: 48% !important;
                margin-right: 1%;
                border: none !important;
                border-bottom: 1px solid #ccc !important;
                background: none !important;
            }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-lumix-dark border-b border-gray-800 sticky top-0 z-40 backdrop-blur-md bg-opacity-90">
        <div class="max-w-7xl mx-auto px-4 py-4 flex flex-col md:flex-row justify-between items-center gap-4">
            <div class="flex items-center gap-6">
                <!-- Logo Merlin -->
                <div class="p-1 rounded">
                    <img src="https://i.ibb.co/wFzQPqk3/Logo-Merlin-40-white.png" alt="Merlin Distributor" class="h-10 w-auto object-contain">
                </div>
                
                <!-- Separador -->
                <div class="h-8 w-px bg-gray-700 hidden sm:block"></div>

                <!-- Logo Lumix -->
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/3e/Lumix_logo.svg/2560px-Lumix_logo.svg.png" alt="LUMIX Logo" class="h-5 w-auto object-contain brightness-0 invert">
                
                <h1 class="text-lg font-light tracking-wide text-gray-400 hidden lg:block">Selector <span class="font-bold text-white">Lumix Beta</span></h1>
            </div>
            
            <!-- Live Search -->
            <div class="flex-grow max-w-md w-full relative group">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <i data-lucide="search" class="h-4 w-4 text-gray-500 group-focus-within:text-lumix-red transition"></i>
                </div>
                <input type="text" id="search-input" 
                    class="bg-gray-800 border border-gray-700 text-gray-100 text-sm rounded-lg focus:ring-1 focus:ring-lumix-red focus:border-lumix-red block w-full pl-10 pr-10 p-2.5 placeholder-gray-500 transition" 
                    placeholder="Buscar: 8K, ProRes RAW, Frame.io, 177 MP..."
                    onkeyup="filterCameras()">
                <button onclick="clearSearch()" id="clear-search-btn" class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-500 hover:text-white hidden">
                    <i data-lucide="x-circle" class="h-4 w-4"></i>
                </button>
            </div>
            
            <div class="flex gap-2 items-center">
                <div class="bg-gray-800 p-1 rounded-lg flex border border-gray-700 mr-2">
                    <button onclick="setView('grid')" id="btn-grid" class="p-2 rounded hover:bg-gray-700 text-lumix-red bg-gray-700 transition" title="Cuadrícula">
                        <i data-lucide="layout-grid" class="w-4 h-4"></i>
                    </button>
                    <button onclick="setView('list')" id="btn-list" class="p-2 rounded hover:bg-gray-700 text-gray-400 transition" title="Lista">
                        <i data-lucide="list" class="w-4 h-4"></i>
                    </button>
                </div>
                <button onclick="resetFilters()" class="flex items-center gap-2 bg-lumix-red hover:bg-red-700 text-white px-4 py-2 rounded text-sm transition font-semibold" title="Reiniciar Filtros">
                    <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
                </button>
            </div>
        </div>
    </header>

    <main class="flex-grow max-w-7xl mx-auto px-4 py-8 w-full flex flex-col lg:flex-row gap-8">
        
        <!-- Sidebar Filters NEW STRUCTURE v2 -->
        <aside class="w-full lg:w-72 flex-shrink-0 space-y-6">
            
            <!-- GRUPO 1: PRODUCTION PRO -->
            <div class="bg-gray-800 p-5 rounded-lg border border-lumix-red shadow-lg relative">
                 <div class="absolute top-0 right-0 bg-lumix-red text-white text-[9px] font-bold px-2 py-1 uppercase">WORKHORSE</div>
                <h3 class="text-white font-tech text-lg uppercase tracking-wider mb-4 border-b border-gray-600 pb-2 flex items-center gap-2">
                    <i data-lucide="clapperboard" class="w-4 h-4 text-lumix-red"></i> PRODUCTION PRO
                </h3>
                <div class="space-y-3">
                     <label class="flex items-center gap-3 cursor-pointer group">
                        <input type="checkbox" class="filter-feat w-5 h-5 rounded border-gray-600 bg-gray-900 text-lumix-red focus:ring-lumix-red" value="ssd">
                        <span class="text-gray-300 group-hover:text-white transition text-sm">Grabación en SSD</span>
                    </label>
                    <label class="flex items-center gap-3 cursor-pointer group">
                        <input type="checkbox" class="filter-feat w-5 h-5 rounded border-gray-600 bg-gray-900 text-lumix-red focus:ring-lumix-red" value="audio">
                        <span class="text-gray-300 group-hover:text-white transition text-sm font-bold featured-label">Audio 32 bit</span>
                    </label>
                    <label class="flex items-center gap-3 cursor-pointer group">
                        <input type="checkbox" class="filter-feat w-5 h-5 rounded border-gray-600 bg-gray-900 text-lumix-red focus:ring-lumix-red" value="timecode">
                        <span class="text-gray-300 group-hover:text-white transition text-sm">Timecode In/Out</span>
                    </label>
                    <label class="flex items-center gap-3 cursor-pointer group">
                        <input type="checkbox" class="filter-feat w-5 h-5 rounded border-gray-600 bg-gray-900 text-lumix-red focus:ring-lumix-red" value="xlr">
                        <span class="text-gray-300 group-hover:text-white transition text-sm">Entrada de audio XLR</span>
                    </label>
                </div>
            </div>

            <!-- GRUPO 2: FORMATOS -->
            <div class="bg-lumix-gray p-5 rounded-lg border border-gray-700">
                <h3 class="text-white font-tech text-lg uppercase tracking-wider mb-4 border-b border-gray-600 pb-2 flex items-center gap-2">
                    <i data-lucide="film" class="w-4 h-4 text-lumix-red"></i> FORMATOS
                </h3>
                <div class="space-y-3">
                     <label class="flex items-center gap-3 cursor-pointer group">
                        <input type="checkbox" class="filter-feat w-5 h-5 rounded border-gray-600 bg-gray-800 text-lumix-red focus:ring-lumix-red" value="arri_log">
                        <span class="text-gray-300 group-hover:text-white transition text-sm font-bold featured-label">Arri LogC3</span>
                    </label>
                     <label class="flex items-center gap-3 cursor-pointer group">
                        <input type="checkbox" class="filter-feat w-5 h-5 rounded border-gray-600 bg-gray-800 text-lumix-red focus:ring-lumix-red" value="6k">
                        <span class="text-gray-300 group-hover:text-white transition text-sm font-bold featured-label">6K / Open Gate</span>
                    </label>
                    <label class="flex items-center gap-3 cursor-pointer group">
                        <input type="checkbox" class="filter-feat w-5 h-5 rounded border-gray-600 bg-gray-800 text-lumix-red focus:ring-lumix-red" value="prores_raw">
                        <span class="text-gray-300 group-hover:text-white transition text-sm">ProRes RAW</span>
                    </label>
                    <label class="flex items-center gap-3 cursor-pointer group">
                        <input type="checkbox" class="filter-feat w-5 h-5 rounded border-gray-600 bg-gray-800 text-lumix-red focus:ring-lumix-red" value="8k">
                        <span class="text-gray-300 group-hover:text-white transition text-sm">8K Ultra High Res</span>
                    </label>
                    <label class="flex items-center gap-3 cursor-pointer group">
                        <input type="checkbox" class="filter-feat w-5 h-5 rounded border-gray-600 bg-gray-800 text-lumix-red focus:ring-lumix-red" value="unlimited">
                        <span class="text-gray-300 group-hover:text-white transition text-sm">Grabación Ilimitada</span>
                    </label>
                </div>
            </div>

            <!-- GRUPO 3: TECH -->
            <div class="bg-lumix-gray p-5 rounded-lg border border-gray-700">
                <h3 class="text-white font-tech text-lg uppercase tracking-wider mb-4 border-b border-gray-600 pb-2 flex items-center gap-2">
                    <i data-lucide="cpu" class="w-4 h-4 text-lumix-red"></i> TECH
                </h3>
                <div class="space-y-3">
                    <label class="flex items-center gap-3 cursor-pointer group">
                        <input type="checkbox" class="filter-feat w-5 h-5 rounded border-gray-600 bg-gray-800 text-lumix-red focus:ring-lumix-red" value="real_time_lut">
                        <span class="text-gray-300 group-hover:text-white transition text-sm font-bold featured-label">Lut en Tiempo Real</span>
                    </label>
                    <label class="flex items-center gap-3 cursor-pointer group">
                        <input type="checkbox" class="filter-feat w-5 h-5 rounded border-gray-600 bg-gray-800 text-lumix-red focus:ring-lumix-red" value="pdaf">
                        <span class="text-gray-300 group-hover:text-white transition text-sm">Enfoque PDAF</span>
                    </label>
                    <label class="flex items-center gap-3 cursor-pointer group" title="Sistema de ventilación activo">
                        <input type="checkbox" class="filter-feat w-5 h-5 rounded border-gray-600 bg-gray-800 text-lumix-red focus:ring-lumix-red" value="fan">
                        <span class="text-gray-300 group-hover:text-white transition text-sm">Ventilador Activo</span>
                    </label>
                </div>
            </div>

        </aside>

        <!-- Main Content -->
        <div class="flex-1">
            <div class="flex justify-between items-center mb-6 no-print">
                <h2 class="text-2xl font-bold text-white"><span id="count-display">0</span> Modelos Disponibles</h2>
                <div class="text-sm text-gray-500 hidden sm:block">
                    Selecciona <span class="text-lumix-red font-bold">Comparar</span> para ver detalles
                </div>
            </div>

            <div id="camera-container" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
                <!-- Content injected here -->
            </div>
            
            <div id="empty-state" class="hidden flex flex-col items-center justify-center py-20 text-gray-500">
                <i data-lucide="camera-off" class="w-16 h-16 mb-4"></i>
                <p class="text-lg">No hay cámaras que coincidan con los filtros.</p>
                <button onclick="resetFilters()" class="mt-4 text-lumix-red hover:underline">Reiniciar Filtros</button>
            </div>
        </div>
    </main>

    <!-- Comparison Tray -->
    <div id="compare-tray" class="fixed bottom-0 left-0 right-0 bg-lumix-dark border-t border-gray-700 p-4 transform translate-y-full transition-transform duration-300 z-50 shadow-2xl">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-4">
                <span class="text-gray-400 text-sm font-tech uppercase tracking-wide">Comparar (<span id="compare-count">0</span>/3)</span>
                <div id="compare-thumbnails" class="flex gap-2"></div>
            </div>
            <div class="flex gap-3">
                <button onclick="clearComparison()" class="text-gray-400 hover:text-white text-sm px-3">Cancelar</button>
                <button onclick="openCompareModal()" class="bg-lumix-red hover:bg-red-700 text-white px-6 py-2 rounded font-bold shadow-lg transition">VER COMPARATIVA</button>
            </div>
        </div>
    </div>

    <!-- Comparison Modal -->
    <div id="comparison-modal" class="fixed inset-0 bg-black/90 z-50 hidden flex flex-col">
        <div class="flex flex-col md:flex-row justify-between items-center p-6 border-b border-gray-800 bg-lumix-dark gap-4 no-print">
            <h2 class="text-2xl font-bold text-white font-tech uppercase">Comparativa Técnica</h2>
            <div class="flex gap-3">
                <button onclick="exportToCSV()" class="flex items-center gap-2 bg-gray-800 hover:bg-green-700 hover:text-white text-gray-300 px-3 py-2 rounded text-xs transition border border-gray-600">
                    <i data-lucide="sheet" class="w-4 h-4"></i> CSV
                </button>
                <button onclick="printComparison()" class="flex items-center gap-2 bg-gray-800 hover:bg-blue-600 hover:text-white text-gray-300 px-3 py-2 rounded text-xs transition border border-gray-600">
                    <i data-lucide="printer" class="w-4 h-4"></i> Imprimir
                </button>
                <button onclick="closeCompareModal()" class="text-gray-400 hover:text-white ml-2"><i data-lucide="x" class="w-8 h-8"></i></button>
            </div>
        </div>
        
        <!-- Printable Header -->
        <div class="hidden print-header">
            <div>
                <img src="https://i.ibb.co/wFzQPqk3/Logo-Merlin-40-white.png" class="h-10">
            </div>
            <div class="text-right">
                <h2 class="text-xl font-bold uppercase text-black">Tabla Comparativa</h2>
                <p class="text-xs text-gray-500">Documento Interno - v.2025.2 (Oficial)</p>
            </div>
        </div>

        <div class="flex-1 overflow-auto p-6">
            <div id="comparison-content" class="min-w-max"></div>
        </div>
    </div>

    <!-- Detail Modal -->
    <div id="detail-modal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
        <div class="bg-gray-900 rounded-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto border border-gray-700 shadow-2xl relative">
            <button onclick="closeModal()" class="absolute top-4 right-4 text-gray-400 hover:text-white z-10 bg-gray-800 rounded-full p-1 no-print">
                <i data-lucide="x" class="w-6 h-6"></i>
            </button>
            
            <!-- Printable Header for Detail -->
            <div class="hidden print-header p-8 pb-0">
                <img src="https://i.ibb.co/wFzQPqk3/Logo-Merlin-40-white.png" class="h-10">
            </div>

            <div id="modal-content" class="p-8"></div>
        </div>
    </div>

    <!-- Notification Toast -->
    <div id="toast" class="fixed bottom-8 right-8 bg-white text-black px-6 py-3 rounded shadow-xl transform translate-y-20 opacity-0 transition-all duration-300 z-[60] no-print">Notificación</div>

    <script>
        // --- Database Updated with CSV Official Data ---
        const cameras = [
            // --- SERIE S ---
            {
                id: "s1rii",
                model: "LUMIX S1RII",
                price: "$3,297.99",
                image: "https://static.bhphoto.com/images/images1000x1000/1740473206_1879621.jpg",
                tagline: "El Nuevo Estándar en Alta Resolución.",
                description: "Resolución masiva para fotógrafos comerciales y de paisaje. Soporta grabación 8.1K, ProRes RAW interno y flujo de trabajo directo a la nube.",
                features: [
                    "Sensor Full-Frame 44,3 MP (Modo Alta Res 177 MP)",
                    "Vídeo 8.1K/8K (10 bits) / C4K 120p",
                    "Integración nativa Frame.io Camera to Cloud",
                    "AF Híbrido de Fase + Contraste + DFD con IA",
                    "Estabilización IBIS 5 ejes (8,0 pasos)"
                ],
                sensorType: "Full-Frame",
                sensorDetail: "Full-Frame 44,3 MP (Alta Res 177 MP)",
                mount: "Montura L",
                ibis: "IBIS 5 ejes (8,0 pasos); Dual I.S. 2",
                focus: "AF Híbrido de Fase + Contraste + DFD con IA",
                videoMax: "8.1K 30p / C4K 120p",
                videoFormats: "MOV, MP4, ProRes RAW HQ (Interno)",
                hdmi: "HDMI Tipo A (Full)",
                openGate: "Sí, en modo 8K/6K",
                screen: "Triaxial Inclinable",
                connectivity: "Wi-Fi 5GHz / Bluetooth 5.0 / Frame.io",
                liveStreamingFeature: "Live Streaming (RTMP/RTMPS), USB Tethering",
                burst: "30 fps (AFC)",
                codecs: "HEVC, AVC, ProRes",
                color: "V-Log / ARRI LogC3 (Con licencia opcional o actualización)",
                storage: "CFexpress Tipo B + SD UHS-II (SSD USB)",
                filters: ["pdaf", "8k", "6k", "4k", "luts", "ibis", "high_res", "dual_slot", "arri_log", "streaming", "audio", "ssd", "timecode", "xlr"], 
                price_tier: 3
            },
            {
                id: "s1ii",
                model: "LUMIX S1II",
                price: "$3,197.99",
                image: "https://static.bhphoto.com/images/images500x500/1747129594_1892230.jpg",
                tagline: "Velocidad y Hibridez Definitiva.",
                description: "Potencia para flujos de trabajo exigentes con sensor parcialmente apilado, ráfagas de 70 fps y soporte ARRI.",
                features: [
                    "Sensor CMOS Parcialmente Apilado 24,1 MP (Alta Res 96 MP)",
                    "Ráfaga 70 fps (Obturador Electrónico)",
                    "Grabación 6K 30p / 5.1K 60p Open Gate",
                    "V-Log 14+ pasos / ARRI LogC3 (Opcional)",
                    "Doble ranura CFexpress B + SD"
                ],
                sensorType: "Full-Frame",
                sensorDetail: "CMOS Parcialmente Apilado 24,1 MP",
                mount: "Montura L",
                ibis: "IBIS 5 ejes (8,0 pasos); Dual I.S. 2",
                focus: "AF Híbrido de Fase + Contraste + DFD con IA",
                videoMax: "6K 30p / 5.1K 60p",
                videoFormats: "MOV, MP4, ProRes",
                hdmi: "HDMI Tipo A (Full)",
                openGate: "Sí, 6K / 5.1K Open Gate",
                screen: "Triaxial Inclinable",
                connectivity: "Wi-Fi 5GHz / Bluetooth 5.0 / Frame.io",
                liveStreamingFeature: "Live Streaming (RTMP/RTMPS), USB Tethering",
                burst: "70 fps (AFC)",
                codecs: "HEVC, AVC, ProRes",
                color: "V-Log / ARRI LogC3 (Con licencia opcional o actualización)",
                storage: "CFexpress Tipo B + SD UHS-II (SSD USB)",
                filters: ["pdaf", "6k", "4k", "luts", "ibis", "flip", "dual_slot", "raw_out", "prores_raw", "arri_log", "streaming", "audio", "ssd", "timecode", "xlr"],
                price_tier: 3
            },
            {
                id: "s1iie",
                model: "LUMIX S1IIE",
                price: "$2,497.99",
                image: "https://www.bhphotovideo.com/images/fb/panasonic_dc_s1m2esbody_lumix_s1iie_mirrorless_camera_1892232.jpg",
                tagline: "Video Profesional Accesible.",
                description: "Hereda las especificaciones de video clave de la S1II (6K Open Gate, V-Log 14+, ProRes RAW interno) en un paquete optimizado.",
                features: [
                    "Sensor CMOS BSI Full-Frame 24,2 MP",
                    "Grabación interna C4K/4K 60p en ProRes RAW HQ",
                    "Open Gate 6K 30p (4:2:0 10 bits)",
                    "Soporte V-Log / Opción ARRI LogC3",
                    "Ranura CFexpress + SD"
                ],
                sensorType: "Full-Frame",
                sensorDetail: "CMOS BSI Full-Frame 24,2 MP",
                mount: "Montura L",
                ibis: "IBIS 5 ejes (8,0 pasos); IS Activo",
                focus: "AF Híbrido de Fase + Contraste + DFD con IA",
                videoMax: "6K 30p / 4K 60p",
                videoFormats: "MOV, MP4, ProRes RAW HQ (Interno)",
                hdmi: "HDMI Tipo A (Full)",
                openGate: "Sí, 6K Open Gate",
                screen: "Triaxial Inclinable",
                connectivity: "Wi-Fi 5GHz / Bluetooth 5.0 / Frame.io",
                liveStreamingFeature: "Live Streaming (RTMP/RTMPS), USB Tethering",
                burst: "30 fps (AFC)",
                codecs: "HEVC, AVC",
                color: "V-Log / Opción ARRI LogC3",
                storage: "CFexpress Tipo B + SD UHS-II (SSD USB)",
                filters: ["pdaf", "6k", "4k", "luts", "ibis", "flip", "dual_slot", "prores_raw", "arri_log", "streaming", "audio", "ssd", "xlr"],
                price_tier: 2
            },
            {
                id: "s5iix",
                model: "LUMIX S5IIX",
                price: "$2,197.99",
                image: "https://www.bhphotovideo.com/images/fb/panasonic_dc_s5miix_ff_mirrorless_camera_1743629.jpg",
                tagline: "Flujo de Trabajo Turbo-Cargado.",
                description: "Grabación directa a SSD por USB-C (para ProRes HQ) y opciones avanzadas de (Wi-Fi/Cable). Diseñada para producciones que necesitan eficiencia en la transferencia de datos.",
                features: [
                    "Sensor CMOS Full-Frame 24,2 MP",
                    "Grabación directa a SSD vía USB-C",
                    "ProRes RAW y All-Intra",
                    "AF Híbrido de Fase",
                    "Cuerpo 'Black' mate"
                ],
                sensorType: "Full-Frame",
                sensorDetail: "CMOS Full-Frame 24,2 megapíxeles",
                mount: "Montura L",
                ibis: "IBIS 5 ejes (6,5 pasos); Dual I.S. 2",
                focus: "AF Híbrido de Fase + Contraste + DFD",
                videoMax: "6K 30p / C4K 60p",
                videoFormats: "MOV, MP4, Apple ProRes, All-Intra",
                hdmi: "HDMI Tipo A (Full)",
                openGate: "Sí, 6K Open Gate",
                screen: "Articulada de ángulo libre",
                connectivity: "Wi-Fi 5GHz / Bluetooth 5.0",
                liveStreamingFeature: "No",
                burst: "30 fps (Elec) / 7 fps (Mec)",
                codecs: "ProRes 422 HQ, All-Intra, HEVC, AVC",
                color: "V-Log / LUT en tiempo real",
                storage: "Doble ranura SD UHS-II (SSD por USB-C)",
                filters: ["pdaf", "6k", "4k", "luts", "ibis", "flip", "ssd", "unlimited", "dual_slot", "fan", "raw_out", "real_time_lut", "prores_raw", "timecode", "xlr"],
                price_tier: 2
            },
            {
                id: "s5ii",
                model: "LUMIX S5II",
                price: "$1,997.99",
                image: "https://www.bhphotovideo.com/images/fb/panasonic_dc_s5m2body_lumix_s5_ii_mirrorless_1742428.jpg",
                tagline: "El Punto Óptimo Híbrido.",
                description: "Introduce el PDAF y la calidad de imagen 6K V-Log en el cuerpo más compacto y asequible de la serie. Excelente valor para quien fotografía y graba video por igual.",
                features: [
                    "Sensor CMOS Full-Frame 24,2 MP",
                    "AF Híbrido de Fase (779 puntos)",
                    "Active I.S. para caminar y grabar",
                    "Grabación de vídeo 6K 30p Open Gate y 4K 60p ilimitado (Fan)",
                    "LUTs en tiempo real"
                ],
                sensorType: "Full-Frame",
                sensorDetail: "CMOS Full-Frame 24,2 megapíxeles",
                mount: "Montura L",
                ibis: "IBIS 5 ejes (6,5 pasos); Dual I.S. 2",
                focus: "AF Híbrido de Fase + Contraste + DFD",
                videoMax: "6K 30p / C4K 60p",
                videoFormats: "MOV, MP4",
                hdmi: "HDMI Tipo A (Full)",
                openGate: "Sí, 6K Open Gate",
                screen: "Articulada de ángulo libre",
                connectivity: "Wi-Fi 5GHz / Bluetooth 5.0",
                liveStreamingFeature: "No",
                burst: "30 fps (Elec) / 7 fps (Mec)",
                codecs: "HEVC, AVC",
                color: "V-Log / LUT en tiempo real",
                storage: "Doble ranura SD UHS-II",
                filters: ["pdaf", "6k", "4k", "luts", "ibis", "flip", "unlimited", "dual_slot", "fan", "real_time_lut", "prores_raw", "xlr"],
                price_tier: 2
            },
            {
                id: "s9",
                model: "LUMIX S9",
                price: "$1,497.99",
                image: "https://www.bhphotovideo.com/images/fb/panasonic_dc_s9bodyk_lumix_s9_mirrorless_camera_1828733.jpg",
                tagline: "La Full-Frame más Compacta y Rápida para Redes Sociales.",
                description: "Calidad FF con 6K Open Gate y flujo de trabajo LUTs en tiempo real (MP4+) para publicación instantánea.",
                features: [
                    "Sensor CMOS Full-Frame 24,2 MP",
                    "Formato MP4 Lite para transferencia rápida",
                    "Botón LUT dedicado en cuerpo",
                    "Estabilización Activa híbrida",
                    "Compacta y ligera"
                ],
                sensorType: "Full-Frame",
                sensorDetail: "CMOS Full-Frame 24,2 megapíxeles",
                mount: "Montura L",
                ibis: "IBIS 5 ejes (5,0 pasos); IS Activo",
                focus: "AF Híbrido de Fase + Contraste + DFD",
                videoMax: "6K 30p (Open Gate)",
                videoFormats: "MP4 Lite, MP4, MOV",
                hdmi: "HDMI Tipo D (Micro)",
                openGate: "Sí, 6K Open Gate",
                screen: "Articulada de ángulo libre",
                connectivity: "Wi-Fi 5GHz / Bluetooth 5.0",
                liveStreamingFeature: "No (Transferencia a App Lumix Lab)",
                burst: "30 fps (Elec)",
                codecs: "HEVC, AVC (MP4 Lite)",
                color: "V-Log / LUT en tiempo real (Botón dedicado)",
                storage: "1x Ranura SD UHS-II",
                filters: ["pdaf", "6k", "4k", "luts", "ibis", "flip", "vlog", "real_time_lut"],
                price_tier: 1
            },
            // --- SERIE G ---
            {
                id: "gh7",
                model: "LUMIX GH7",
                price: "$2,197.99",
                image: "https://www.bhphotovideo.com/images/fb/panasonic_dc_gh7body_lumix_gh7_mirrorless_camera_1832646.jpg",
                tagline: "Potencia de Producción en un Cuerpo MFT.",
                description: "Flujo de trabajo Apple ProRes RAW a SSD, audio flotante de 32-bit (vía adaptador XLR), y robustez para cualquier entorno. Ideal para broadcast y producciones en gimbals.",
                features: [
                    "Sensor BSI Live MOS (MFT) 25,2 MP",
                    "Grabación interna de Apple ProRes RAW",
                    "Audio flotante de 32 bits (con DMW-XLR2)",
                    "Soporte nativo Adobe Frame.io Camera to Cloud",
                    "Ventilador de refrigeración activo"
                ],
                sensorType: "MFT",
                sensorDetail: "CMOS BSI Live MOS (MFT) 25,2 megapíxeles",
                mount: "Montura Micro Cuatro Tercios",
                ibis: "IBIS 5 ejes (7,5 pasos); Dual I.S. 2",
                focus: "AF Híbrido de Fase + Contraste + DFD",
                videoMax: "5.7K 60p / 4K 120p",
                videoFormats: "MOV, MP4, Apple ProRes, ProRes RAW HQ",
                hdmi: "HDMI Tipo A (Full)",
                openGate: "Sí, 5.8K Open Gate",
                screen: "Articulada de ángulo libre e inclinable",
                connectivity: "Wi-Fi 5GHz / Bluetooth 5.0 / Frame.io",
                liveStreamingFeature: "Live Streaming (RTMP/RTMPS), USB Tethering",
                burst: "75 fps (Elec) / 60 fps (AFC)",
                codecs: "ProRes RAW HQ, ProRes 422, All-Intra",
                color: "V-Log / LUT en tiempo real",
                storage: "CFexpress Tipo B + SD UHS-II",
                filters: ["pdaf", "6k", "4k", "luts", "ibis", "flip", "ssd", "unlimited", "dual_slot", "fan", "raw_out", "real_time_lut", "prores_raw", "streaming", "audio", "arri_log", "timecode", "xlr"],
                price_tier: 3
            },
            {
                id: "g97",
                model: "LUMIX G97",
                price: "$847.99",
                image: "https://static.bhphoto.com/images/images1500x1500/1734378342_1869315.jpg",
                tagline: "El Equilibrio entre Foto y Video MFT.",
                description: "Cuerpo tipo DSLR con agarre cómodo, V-Log L pre-instalado y jacks de audio completos. Excelente valor para video 4K premium no broadcast.",
                features: [
                    "Sensor CMOS (MFT) 20,3 MP",
                    "Video 4K 30p / FHD 60p",
                    "V-Log L preinstalado",
                    "Cuerpo robusto resistente a salpicaduras/polvo",
                    "IBIS de 5 ejes Dual I.S. 2"
                ],
                sensorType: "MFT",
                sensorDetail: "CMOS (MFT) 20,3 megapíxeles",
                mount: "Montura Micro Cuatro Tercios",
                ibis: "IBIS 5 ejes (5,0 pasos); Dual I.S. 2",
                focus: "DFD (Contraste)",
                videoMax: "4K 30p / FHD 60p",
                videoFormats: "MP4, AVCHD",
                hdmi: "HDMI Tipo D (Micro)",
                openGate: "No",
                screen: "Articulada de ángulo libre",
                connectivity: "Wi-Fi / Bluetooth 4.2",
                liveStreamingFeature: "No",
                burst: "9 fps (AFS) / 6 fps (AFC)",
                codecs: "AVCHD, MP4",
                color: "V-Log L (Preinstalado)",
                storage: "1x Ranura SD UHS-II",
                filters: ["4k", "luts", "ibis", "flip", "unlimited", "dual_slot", "xlr"],
                price_tier: 1
            },
            {
                id: "g100d",
                model: "LUMIX G100D",
                price: "$747.99",
                image: "https://static.bhphoto.com/images/images1000x1000/1704725720_1804791.jpg",
                tagline: "La Herramienta Definitiva para Vlogging Ultra-Portátil.",
                description: "La más ligera de la línea, con Audio OZO (micrófono con seguimiento de rostro) y pantalla selfie articulada. Ideal para un fácil salto de calidad desde el smartphone.",
                features: [
                    "Sensor CMOS (MFT) 20,3 MP",
                    "Audio OZO de Nokia (Seguimiento sonoro)",
                    "Modo Video Selfie con indicador visual",
                    "Visor OLED mejorado",
                    "Conectividad fácil para smartphones"
                ],
                sensorType: "MFT",
                sensorDetail: "CMOS (MFT) 20,3 megapíxeles",
                mount: "Montura Micro Cuatro Tercios",
                ibis: "HYBRID I.S. de 5 ejes (Electrónico + Lente)",
                focus: "DFD (Contraste)",
                videoMax: "4K 30p / FHD 60p",
                videoFormats: "MP4",
                hdmi: "HDMI Tipo D (Micro)",
                openGate: "No",
                screen: "Articulada de ángulo libre (Selfie)",
                connectivity: "Wi-Fi / Bluetooth 4.2",
                liveStreamingFeature: "No",
                burst: "10 fps (AFS) / 6 fps (AFC)",
                codecs: "MP4 (H.264)",
                color: "V-Log L (Preinstalado)",
                storage: "1x Ranura SD UHS-II",
                filters: ["4k", "luts", "ibis", "flip", "vlog"],
                price_tier: 1
            }
        ];

        // --- State Management ---
        let selectedComparison = [];
        let viewMode = 'grid';

        // --- DOM Elements ---
        const container = document.getElementById('camera-container');
        const emptyState = document.getElementById('empty-state');
        const countDisplay = document.getElementById('count-display');
        const inputs = document.querySelectorAll('input[type="checkbox"]');
        const searchInput = document.getElementById('search-input');
        const clearSearchBtn = document.getElementById('clear-search-btn');
        const compareTray = document.getElementById('compare-tray');
        const compareCount = document.getElementById('compare-count');
        const compareThumbnails = document.getElementById('compare-thumbnails');
        const btnGrid = document.getElementById('btn-grid');
        const btnList = document.getElementById('btn-list');

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            renderCameras(cameras);
            lucide.createIcons();
            inputs.forEach(input => input.addEventListener('change', filterCameras));
        });

        // --- View Switching ---
        function setView(mode) {
            viewMode = mode;
            if(mode === 'grid') {
                btnGrid.classList.replace('text-gray-400', 'text-lumix-red'); btnGrid.classList.add('bg-gray-700');
                btnList.classList.replace('text-lumix-red', 'text-gray-400'); btnList.classList.remove('bg-gray-700');
                container.className = "grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6";
            } else {
                btnList.classList.replace('text-gray-400', 'text-lumix-red'); btnList.classList.add('bg-gray-700');
                btnGrid.classList.replace('text-lumix-red', 'text-gray-400'); btnGrid.classList.remove('bg-gray-700');
                container.className = "flex flex-col gap-3";
            }
            filterCameras();
        }

        // --- Filter & Search Logcic ---
        function filterCameras() {
            const filterGroups = {
                feat: Array.from(document.querySelectorAll('.filter-feat:checked')).map(cb => cb.value)
            };
            const searchText = searchInput.value.toLowerCase();
            
            clearSearchBtn.classList.toggle('hidden', searchText.length === 0);

            const filtered = cameras.filter(cam => {
                // Logic: For each checked filter, the camera MUST have that specific tag.
                // This creates an "AND" relationship between selected filters.
                // If no filters are checked in a category, that category is ignored (matches all).
                const featMatch = filterGroups.feat.length === 0 || filterGroups.feat.every(f => cam.filters.includes(f));
                
                const searchMatch = searchText === "" || 
                                    cam.model.toLowerCase().includes(searchText) ||
                                    cam.sensorDetail.toLowerCase().includes(searchText) ||
                                    cam.filters.join(" ").includes(searchText);

                return featMatch && searchMatch;
            });

            renderCameras(filtered);
        }

        function clearSearch() { searchInput.value = ''; filterCameras(); searchInput.focus(); }

        function renderCameras(list) {
            container.innerHTML = '';
            countDisplay.innerText = list.length;

            if (list.length === 0) {
                container.classList.add('hidden');
                emptyState.classList.remove('hidden');
                return;
            }

            container.classList.remove('hidden');
            emptyState.classList.add('hidden');

            list.forEach(cam => {
                const isSelected = selectedComparison.includes(cam.id);
                const badgeColor = cam.sensorType === 'Full-Frame' ? 'bg-lumix-red' : 'bg-blue-600';
                
                // Generar Badges dinámicos
                let specialBadges = '';
                if(cam.filters.includes('pdaf')) specialBadges += `<span class="bg-gray-700 text-white text-[9px] px-1 rounded border border-gray-600">Eye AF</span>`;
                if(cam.openGate && (cam.openGate.includes("Sí") || cam.filters.includes('6k'))) {
                    specialBadges += `<span class="bg-indigo-600 text-white text-[9px] px-1 rounded border border-indigo-500">Open Gate</span>`;
                }
                if(cam.filters.includes('dual_slot')) specialBadges += `<span class="bg-green-800 text-white text-[9px] px-1 rounded border border-green-600">Dual Slot</span>`;
                if(cam.filters.includes('fan')) specialBadges += `<span class="bg-red-900 text-white text-[9px] px-1 rounded border border-red-700"><i data-lucide="fan" class="inline w-2 h-2"></i></span>`;
                if(cam.filters.includes('arri_log')) specialBadges += `<span class="bg-orange-800 text-white text-[9px] px-1 rounded border border-orange-600">ARRI LogC3</span>`;

                let html = '';

                if (viewMode === 'grid') {
                    html = `
                    <div class="lumix-card bg-gray-800 rounded-lg overflow-hidden flex flex-col relative ${isSelected ? 'border-lumix-red ring-1 ring-lumix-red' : ''}">
                        <div class="absolute top-0 right-0 p-2 z-10">
                            <label class="flex items-center gap-2 bg-black/50 backdrop-blur px-2 py-1 rounded cursor-pointer hover:bg-black/80 transition select-none">
                                <span class="text-xs font-bold text-gray-300">COMPARAR</span>
                                <input type="checkbox" class="lumix-checkbox rounded text-lumix-red focus:ring-0" 
                                    onclick="toggleCompare('${cam.id}', this)" ${isSelected ? 'checked' : ''}>
                            </label>
                        </div>
                        <div class="h-48 bg-white flex items-center justify-center relative p-4 group overflow-hidden">
                            <img src="${cam.image}" alt="${cam.model}" class="w-full h-full object-contain transition duration-300 group-hover:scale-105">
                            <div class="absolute bottom-2 left-2 flex flex-wrap gap-1 items-center">
                                <span class="${badgeColor} text-white text-xs font-bold px-2 py-1 rounded shadow-lg">${cam.sensorType}</span>
                                <div class="flex gap-1 flex-wrap">${specialBadges}</div>
                            </div>
                        </div>
                        <div class="p-5 flex-grow flex flex-col">
                            <div class="mb-4">
                                <h3 class="text-xl font-bold text-white mb-1">${cam.model}</h3>
                                <p class="text-gray-400 text-xs italic line-clamp-2 min-h-[2.5em]">${cam.tagline}</p>
                            </div>
                            <div class="space-y-2 mb-6 flex-grow">
                                <div class="flex items-center gap-2 text-sm text-gray-300">
                                    <i data-lucide="film" class="w-4 h-4 text-lumix-red"></i> <span>${cam.videoMax}</span>
                                </div>
                                <div class="flex items-center gap-2 text-sm text-gray-300">
                                    <i data-lucide="scan-face" class="w-4 h-4 text-lumix-red"></i> <span>${cam.focus}</span>
                                </div>
                                 <div class="flex items-center gap-2 text-sm text-gray-300">
                                    <i data-lucide="activity" class="w-4 h-4 text-lumix-red"></i> <span>${cam.ibis}</span>
                                </div>
                            </div>
                            
                            <!-- Precio en Grid View -->
                            <div class="mb-4 pt-2 border-t border-gray-700 flex justify-between items-end">
                                <div>
                                    <div class="text-2xl font-bold text-white leading-none">${cam.price}</div>
                                    <div class="text-[10px] text-gray-500 uppercase tracking-wider">MSRP (FOB USA)</div>
                                </div>
                            </div>

                            <button onclick="openModal('${cam.id}')" class="w-full bg-transparent border border-gray-600 hover:border-white hover:text-white text-gray-300 py-2 rounded text-sm font-semibold transition flex items-center justify-center gap-2">
                                <i data-lucide="info" class="w-4 h-4"></i> Ver Detalles
                            </button>
                        </div>
                    </div>`;
                } else {
                    html = `
                    <div class="bg-gray-800 rounded-lg p-3 flex flex-col sm:flex-row gap-4 items-center border border-gray-700 hover:border-gray-500 transition ${isSelected ? 'border-lumix-red ring-1 ring-lumix-red' : ''}">
                        <div class="w-full sm:w-24 h-20 bg-white rounded flex-shrink-0 flex items-center justify-center p-1 relative">
                             <img src="${cam.image}" class="w-full h-full object-contain">
                             <span class="${badgeColor} text-white text-[10px] font-bold px-1 rounded absolute bottom-0 left-0">${cam.sensorType}</span>
                        </div>
                        <div class="flex-grow text-center sm:text-left">
                            <h3 class="text-lg font-bold text-white flex items-center justify-center sm:justify-start gap-2">${cam.model} <div class="flex gap-1 flex-wrap">${specialBadges}</div></h3>
                            <div class="text-xs text-gray-400 mt-1 grid grid-cols-2 sm:flex sm:gap-4">
                                <span class="flex items-center gap-1 justify-center sm:justify-start"><i data-lucide="film" class="w-3 h-3 text-lumix-red"></i> ${cam.videoMax}</span>
                                <span class="flex items-center gap-1 justify-center sm:justify-start"><i data-lucide="scan-face" class="w-3 h-3 text-lumix-red"></i> ${cam.focus}</span>
                            </div>
                        </div>
                        
                        <!-- Precio en List View -->
                        <div class="text-center sm:text-right px-4 border-l border-gray-700 hidden sm:block min-w-[120px]">
                            <div class="text-xl font-bold text-white">${cam.price}</div>
                            <div class="text-[9px] text-gray-500 uppercase">MSRP</div>
                        </div>

                        <div class="flex flex-row sm:flex-col gap-2 w-full sm:w-auto">
                             <button onclick="openModal('${cam.id}')" class="flex-1 bg-gray-700 hover:bg-gray-600 text-white text-xs px-3 py-2 rounded transition">Detalles</button>
                             <label class="flex-1 bg-black/30 hover:bg-black/50 text-gray-300 text-xs px-3 py-2 rounded cursor-pointer flex items-center justify-center gap-2 transition select-none">
                                <input type="checkbox" class="rounded text-lumix-red focus:ring-0" 
                                    onclick="toggleCompare('${cam.id}', this)" ${isSelected ? 'checked' : ''}> Comparar
                            </label>
                        </div>
                    </div>`;
                }

                const wrapper = document.createElement('div');
                wrapper.className = viewMode === 'list' ? 'w-full' : '';
                wrapper.innerHTML = html;
                container.appendChild(wrapper.firstElementChild);
            });
            lucide.createIcons();
        }

        // --- Comparison & Modal Logic ---

        function toggleCompare(id, checkbox) {
            if (checkbox.checked) {
                if (selectedComparison.length >= 3) {
                    showToast('Máximo 3 cámaras para comparar');
                    checkbox.checked = false;
                    return;
                }
                selectedComparison.push(id);
            } else {
                selectedComparison = selectedComparison.filter(item => item !== id);
            }
            updateCompareUI();
        }

        function updateCompareUI() {
            filterCameras();
            compareCount.innerText = selectedComparison.length;
            compareThumbnails.innerHTML = '';
            selectedComparison.forEach(id => {
                const cam = cameras.find(c => c.id === id);
                const thumb = document.createElement('div');
                thumb.className = "bg-gray-700 px-2 py-1 rounded text-xs text-white border border-gray-500 flex items-center gap-2";
                thumb.innerHTML = `${cam.model} <button onclick="toggleCompare('${id}', {checked:false})" class="hover:text-red-400"><i data-lucide="x" class="w-3 h-3"></i></button>`;
                compareThumbnails.appendChild(thumb);
            });
            compareTray.classList.toggle('translate-y-full', selectedComparison.length === 0);
            lucide.createIcons();
        }

        function clearComparison() { selectedComparison = []; updateCompareUI(); }

        function openCompareModal() {
            const modal = document.getElementById('comparison-modal');
            const content = document.getElementById('comparison-content');
            document.body.classList.add('modal-open');
            const selectedCams = cameras.filter(c => selectedComparison.includes(c.id));
            
            let html = `
                <table class="w-full text-left border-collapse">
                    <thead>
                        <tr>
                            <th class="p-4 bg-gray-800 text-gray-400 border-b border-gray-700 sticky left-0 z-10 w-48">Especificación</th>
                            ${selectedCams.map(c => `
                                <th class="p-4 bg-gray-800 text-white border-b border-gray-700 min-w-[160px]"> <!-- REDUCED MIN-WIDTH to 160px -->
                                    <div class="h-16 w-full max-w-[120px] mx-auto bg-white rounded mb-2 flex items-center justify-center p-1 border border-gray-700"> <!-- REDUCED HEIGHT to h-16 and CENTERED -->
                                        <img src="${c.image}" class="h-full w-full object-contain">
                                    </div>
                                    <div class="text-xl font-bold">${c.model}</div>
                                    <div class="text-lg font-bold text-lumix-red mt-1 price-tag">${c.price}</div>
                                </th>
                            `).join('')}
                        </tr>
                    </thead>
                    <tbody class="text-sm">
                        ${generateRow('Sensor', selectedCams, 'sensorDetail')}
                        ${generateRow('Video Max', selectedCams, 'videoMax')}
                        ${generateRow('Formato Archivo', selectedCams, 'videoFormats')}
                        ${generateRow('Enfoque (AF)', selectedCams, 'focus')}
                        ${generateRow('Estabilización', selectedCams, 'ibis')}
                        ${generateRow('Pantalla', selectedCams, 'screen')}
                        ${generateRow('Conectividad', selectedCams, 'connectivity')}
                        ${generateRow('Live Streaming', selectedCams, 'liveStreamingFeature')}
                        ${generateRow('Ráfaga / Foto', selectedCams, 'burst')}
                        ${generateRow('Color / LUTs', selectedCams, 'color')}
                        ${generateRow('HDMI / OpenGate', selectedCams, 'hdmi')}
                        ${generateRow('Almacenamiento', selectedCams, 'storage')}
                    </tbody>
                </table>`;
            content.innerHTML = html;
            modal.classList.remove('hidden');
        }

        function generateRow(label, cams, key) {
            return `<tr class="hover:bg-gray-800/50 transition">
                <td class="p-4 border-b border-gray-800 font-bold text-gray-400 sticky left-0 bg-lumix-dark">${label}</td>
                ${cams.map(c => `<td class="p-4 border-b border-gray-800 text-gray-200 align-top">${c[key] || '-'}</td>`).join('')}
            </tr>`;
        }

        function closeCompareModal() { document.getElementById('comparison-modal').classList.add('hidden'); document.body.classList.remove('modal-open'); }
        
        function openModal(id) {
            const cam = cameras.find(c => c.id === id);
            const modal = document.getElementById('detail-modal');
            const content = document.getElementById('modal-content');
            document.body.classList.add('modal-open');

            // Renderizar la lista de características
            let featuresHtml = '';
            if (cam.features && cam.features.length > 0) {
                featuresHtml = `
                    <div class="mb-6 bg-gray-800/50 p-4 rounded border border-gray-700">
                        <h4 class="text-lumix-red font-bold uppercase text-xs tracking-wider mb-2 flex items-center gap-2">
                            <i data-lucide="star" class="w-3 h-3"></i> Puntos Clave
                        </h4>
                        <ul class="text-gray-200 text-sm space-y-1 list-disc list-inside features-list">
                            ${cam.features.map(f => `<li>${f}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }

            content.innerHTML = `
                <div class="flex flex-col md:flex-row gap-8">
                    <div class="w-full md:w-1/3">
                        <div class="bg-white rounded-lg aspect-square flex items-center justify-center mb-4 p-4 border border-gray-700">
                             <img src="${cam.image}" class="w-full h-full object-contain">
                        </div>
                        <h2 class="text-3xl font-bold text-white mb-1">${cam.model}</h2>
                        <div class="text-2xl font-bold text-lumix-red mb-2 price-tag">${cam.price} <span class="text-sm font-normal text-gray-400">MSRP</span></div>
                        <span class="bg-lumix-red text-white text-sm font-bold px-3 py-1 rounded inline-block mb-4">${cam.sensorType}</span>
                    </div>
                    <div class="w-full md:w-2/3 space-y-6">
                        <div>
                            <h3 class="text-xl font-bold text-white mb-2">Resumen</h3>
                            <p class="text-gray-300 italic border-l-4 border-lumix-red pl-4 mb-4">${cam.description}</p>
                            ${featuresHtml}
                        </div>
                        
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            ${specBox('Sensor', cam.sensorDetail)}
                            ${specBox('Video', cam.videoMax)}
                            ${specBox('Formatos', cam.videoFormats)}
                            ${specBox('Streaming', cam.liveStreamingFeature)}
                            ${specBox('Enfoque', cam.focus)}
                            ${specBox('Estabilización', cam.ibis)}
                            ${specBox('Pantalla', cam.screen)}
                            ${specBox('Conectividad', cam.connectivity)}
                            ${specBox('Color', cam.color)}
                            ${specBox('Slots', cam.storage)}
                        </div>
                        <div class="pt-4 border-t border-gray-700 flex gap-3 no-print">
                             <button onclick="toggleCompare('${cam.id}', {checked:true}); closeModal();" class="flex-1 bg-gray-700 hover:bg-gray-600 text-white py-3 rounded font-bold transition">Comparar</button>
                             <a href="mailto:sales@merlindistributor.com" class="flex-1 bg-lumix-red hover:bg-red-700 text-white py-3 rounded font-bold transition text-center flex items-center justify-center">Contactar</a>
                        </div>
                    </div>
                </div>`;
            modal.classList.remove('hidden');
            lucide.createIcons();
        }

        // --- Visualización Mejorada de Especificaciones con Iconos ---
        function specBox(label, value) {
            // Mapeo de iconos basado en el label (aproximado)
            let iconName = 'cpu'; // Default
            if (label.includes('Sensor')) iconName = 'aperture';
            if (label.includes('Video') || label.includes('Formatos')) iconName = 'film';
            if (label.includes('Streaming')) iconName = 'cast';
            if (label.includes('Enfoque')) iconName = 'scan-face';
            if (label.includes('Estabilización')) iconName = 'activity';
            if (label.includes('Pantalla')) iconName = 'monitor';
            if (label.includes('Conectividad')) iconName = 'wifi';
            if (label.includes('Color')) iconName = 'palette';
            if (label.includes('Slots')) iconName = 'hard-drive';

            return `
            <div class="bg-gray-800 p-3 rounded border border-gray-700 flex items-start gap-3">
                <div class="mt-1 text-lumix-red">
                    <i data-lucide="${iconName}" class="w-4 h-4"></i>
                </div>
                <div>
                    <span class="text-xs text-gray-400 uppercase block mb-0.5 font-bold">${label}</span>
                    <span class="text-white font-medium text-sm leading-tight block">${value}</span>
                </div>
            </div>`;
        }

        function closeModal() { document.getElementById('detail-modal').classList.add('hidden'); document.body.classList.remove('modal-open'); }
        
        function printComparison() { window.print(); }
        
        function exportToCSV() {
            const selectedCams = cameras.filter(c => selectedComparison.includes(c.id));
            if(selectedCams.length === 0) return;
            let csv = "data:text/csv;charset=utf-8,\uFEFFEspecificación," + selectedCams.map(c => `"${c.model} (${c.price})"`).join(",") + "\r\n";
            const keys = [
                { id: 'sensorDetail', l: 'Sensor' }, { id: 'videoMax', l: 'Video' }, { id: 'focus', l: 'Enfoque' }, 
                { id: 'ibis', l: 'Estabilización' }, { id: 'screen', l: 'Pantalla' }, { id: 'connectivity', l: 'Conectividad' }
            ];
            keys.forEach(k => { csv += `"${k.l}",` + selectedCams.map(c => `"${c[k.id]}"`).join(",") + "\r\n"; });
            const link = document.createElement("a"); link.href = encodeURI(csv); link.download = "lumix_comparativa.csv"; link.click();
        }

        function resetFilters() { inputs.forEach(i => i.checked = false); searchInput.value = ''; selectedComparison = []; updateCompareUI(); filterCameras(); }
        function showToast(msg) { const t = document.getElementById('toast'); t.innerText = msg; t.classList.remove('opacity-0', 'translate-y-20'); setTimeout(() => t.classList.add('opacity-0', 'translate-y-20'), 3000); }
    </script>
</body>
</html>
